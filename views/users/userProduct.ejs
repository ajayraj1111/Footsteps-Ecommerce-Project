<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.js"></script>

<!-- Include SweetAlert CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Include SweetAlert JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
	.pagination {
  margin-top: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.pagination-button {
  display: inline-block;
  padding: 8px 16px;
  margin-right: 5px;
  text-decoration: none;
  color: #ffffff;
  background-color: #99c2ee;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.pagination-button.active {
  background-color: #f2a35e;
}

.pagination-button:hover {
  background-color: #f2a35e;
}

.pagination-button:disabled {
  background-color: #b3b3b3;
  cursor: not-allowed;
}

</style>

<main class="main">
	<div class="page-header text-center" style="background-image: url('/user/assets/images/page-header-bg.jpg')">
		<div class="container">
			<h1 class="page-title">Products<span>Mens</span></h1>
		</div><!-- End .container -->
	</div><!-- End .page-header -->
	<!-- <nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
		<div class="container">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="index.html">Home</a></li>
				<li class="breadcrumb-item"><a href="#">Shop</a></li>
				<li class="breadcrumb-item active" aria-current="page">Grid 3 Columns</li>
			</ol>
		</div>End .container 
	</nav>End .breadcrumb-nav -->

	<div class="page-content">
		<div class="container">
			<div class="row">
				<div class="col-lg-9">
					<div class="toolbox">
						<div class="toolbox-left">
							<!-- <div class="toolbox-info">
								Showing <span>9 of 56</span> Products
							</div>End .toolbox-info -->
						</div><!-- End .toolbox-left -->

						<!-- <div class="toolbox-right">
							<div class="toolbox-sort">
								<label for="sortby">Sort by:</label>
								<div class="select-custom">
									<select name="sortby" id="sortby" class="form-control">
										<option value="popularity" selected="selected">Most Popular</option>
										<option value="rating">Most Rated</option>
										<option value="date">Date</option>
									</select>
								</div>
							</div> End .toolbox-sort

						</div>End .toolbox-right -->

					</div><!-- End .toolbox -->


					<div class="products mb-3">
						<div class="row justify-content-center" id="products-row">


							<% for( let i=0; i < products.length; i++ ) { %>

								<% if (product[i].product_status ) { %>
									<div class="col-6 col-md-4 col-lg-4">
										<div class="product product-7 text-center">
											<figure class="product-media">
												<!-- <span class="product-label label-new">New</span> -->
												<a href="/productDisplay/<%= product[i]._id %>">
													<img src="/uploads/product-images/<%= product[i].image[0] %>"
														alt="Product image" class="product-image"
														style="width: 30rem; height: 25rem;">
												</a>
												<% if (!product[i].isInWishlist) { %>
													<div class="product-action-vertical">
														<a href="#"
															class="btn-product-icon btn-wishlist add-to-wishlist btn-expandable"
															data-value="<%= product[i]._id %>">
															<span>add to wishlist</span>
														</a>
													</div><!-- End .product-action-vertical -->

													<% } else{%>
														<div class="product-action-vertical">
															<a href="/view-wishlist"
																class="btn-product-icon btn-wishlist btn-expandable bg-danger">
																<span style="background-color: red;">remove from
																	wishlist</span>
															</a>
														</div><!-- End .product-action-vertical -->

														<% } %>

															<% if (!product[i].isInCart) { %>

																<% if (loginStatus) { %>

																	<div class="product-action">
																		<a href="#" data-value="<%= product[i]._id %>"
																			class="add-product btn-product btn-cart"><span>add
																				to
																				cart</span></a>

																	</div><!-- End .product-action -->
																	<% } else {%>
																		<div class="product-action">
																			<a href="/login"
																				class=" btn-product btn-cart"><span>add
																					to cart</span></a>
																		</div><!-- End .product-action -->
																		<% } %>

																			<% } else { %>

																				<div class="product-action">
																					<a href="/cart"
																						class="view-cart-products btn-product btn"><span>View
																							in cart</span></a>
																				</div><!-- End .product-action -->

																				<% } %>
											</figure><!-- End .product-media -->

											<div class="product-body">
												<div class="product-cat">
													<p>
														<%= product[i].product_description %>
													</p>
												</div><!-- End .product-cat -->
												<h3 class="product-title"><a href="product.html">
														<%= product[i].product_name %>
													</a></h3><!-- End .product-title -->
												<div class="product-price">
													<%= product[i].product_price %>
												</div>
												<!-- End .product-price -->
												<!-- <div class="ratings-container">
												<div class="ratings">
													<div class="ratings-val" style="width: 0%;"></div>End .ratings-val -->
												<!-- </div> End .ratings  -->
												<!-- <span class="ratings-text">( 0 Reviews )</span>
											</div>End .rating-container -->

												<!-- <div class="product-nav product-nav-thumbs">
												<a href="#" class="active">
													<img src="/user/assets/images/products/product-8-thumb.jpg"
														alt="product desc">
												</a>
												<a href="#">
													<img src="/user/assets/images/products/product-8-2-thumb.jpg"
														alt="product desc">
												</a>
											</div>End .product-nav -->
											</div><!-- End .product-body -->
										</div><!-- End .product -->
									</div><!-- End .col-sm-6 col-lg-4 -->
									<% } %>

										<% } %>






						</div><!-- End .row -->
						<!-- Pagination -->
						<div class="pagination">
							<% if (totalPages > 1) { %>
							  <% if (currentPage > 1) { %>
								<a href="/productPage?page=<%= currentPage - 1 %>" class="pagination-button">&laquo; Previous</a>
								<br>
							  <% } %>
						  
							  <% for (let i = 1; i <= totalPages; i++) { %>
								<% if (i === currentPage) { %>
								  <a href="/productPage?page=<%= i %>" class="pagination-button active"><%= i %></a>
								  <br>
								<% } else { %>
								  <a href="/productPage?page=<%= i %>" class="pagination-button"><%= i %></a>
								  <br>
								<% } %>
							  <% } %>
						  
							  <% if (currentPage < totalPages) { %>
								<a href="/productPage?page=<%= currentPage + 1 %>" class="pagination-button">Next &raquo;</a>
								<br>
							  <% } %>
							<% } %>
						  </div>
	<!-- End Pagination -->
				
					
					</div><!-- End .products -->
					
			

					<!-- <nav aria-label="Page navigation">
						<ul class="pagination justify-content-center">
							<li class="page-item disabled">
								<a class="page-link page-link-prev" href="#" aria-label="Previous" tabindex="-1"
									aria-disabled="true">
									<span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
								</a>
							</li>
							<li class="page-item active" aria-current="page"><a class="page-link" href="#">1</a></li>
							<li class="page-item"><a class="page-link" href="#">2</a></li>
							<li class="page-item"><a class="page-link" href="#">3</a></li>
							<li class="page-item-total">of 6</li>
							<li class="page-item">
								<a class="page-link page-link-next" href="#" aria-label="Next">
									Next <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
								</a>
							</li>
						</ul>
					</nav> -->
				</div><!-- End .col-lg-9 -->
				<aside class="col-lg-3 order-lg-first">

					<form id="filter-form">

						<div class="sidebar sidebar-shop">
							<div class="widget widget-clean">
								<label>Filters:</label>
								<a id="clearButton" class="sidebar-filter-clear" style="cursor: pointer;">Clean All</a>
							</div>
							<!-- End .widget widget-clean -->

							<br>
							<div class="widget widget-collapsible">
								<h3 class="widget-title">
									<a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true"
										aria-controls="widget-1">
										Category
									</a>
								</h3><!-- End .widget-title -->

								<div class="collapse show" id="widget-1">
									<div class="widget-body">
										<div class="filter-items filter-items-count">


											<%= console.log(allCategories,"hi"); %>

												<% var i=1 %>
													<% allCategories.forEach(category=> { %>
														<% if (category.status) { %>

															<div class="filter-item">
																<div class="custom-control custom-checkbox">
																	<input type="checkbox" name="category<%= i %>"
																		id="category<%= i %>"
																		value="<%= category._id %>"
																		class="custom-control-input checkBox-input">
																	<label class="custom-control-label"
																		for="category<%= i %>">
																		<%= category.name %>
																	</label>
																</div><!-- End .custom-checkbox -->
																<% i++ %>
															</div><!-- End .filter-item -->

															<% } %>
																<% }) %>
										</div><!-- End .filter-items -->
									</div><!-- End .widget-body -->
								</div><!-- End .collapse -->
							</div><!-- End .widget -->


							<div class="widget widget-collapsible">
								<h3 class="widget-title">
									<a data-toggle="collapse" href="#widget-5" role="button" aria-expanded="true"
										aria-controls="widget-5">
										Price Range
									</a>
								</h3><!-- End .widget-title -->

								<div class="collapse show" id="widget-5">
									<div class="widget-body">
										<div class="filter-price">



											<div id="rangeSlider"></div><br>

											<div>
												<span>From: </span>
												<span id="from-span">skjdfks</span>
												<input type="hidden" id="sliderValue1" name="min"
													style="max-width: 100px;" required><br>
												<span>To:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
												<span id="to-span">sfdgs</span>
												<input type="hidden" id="sliderValue2" name="max"
													style="max-width: 100px;" required>
											</div>



										</div><!-- End .filter-price -->
									</div><!-- End .widget-body -->
								</div><!-- End .collapse -->
							</div><!-- End .widget -->


							<%# <div class="widget widget-collapsible">
								<h3 class="widget-title">
									<a data-toggle="collapse" href="#widget-2" role="button" aria-expanded="true"
										aria-controls="widget-2">
										Size
									</a>
								</h3><!-- End .widget-title -->

								<div class="collapse show" id="widget-2">
									<div class="widget-body">
										<div class="filter-items">
											<div class="filter-item">
												<div class="custom-control custom-checkbox">
													<input type="checkbox" class="custom-control-input" id="size-1">
													<label class="custom-control-label" for="size-1">XS</label>
												</div><!-- End .custom-checkbox -->
											</div><!-- End .filter-item -->

											<div class="filter-item">
												<div class="custom-control custom-checkbox">
													<input type="checkbox" class="custom-control-input" id="size-2">
													<label class="custom-control-label" for="size-2">S</label>
												</div><!-- End .custom-checkbox -->
											</div><!-- End .filter-item -->

											<div class="filter-item">
												<div class="custom-control custom-checkbox">
													<input type="checkbox" class="custom-control-input" checked
														id="size-3">
													<label class="custom-control-label" for="size-3">M</label>
												</div><!-- End .custom-checkbox -->
											</div><!-- End .filter-item -->

											<div class="filter-item">
												<div class="custom-control custom-checkbox">
													<input type="checkbox" class="custom-control-input" checked
														id="size-4">
													<label class="custom-control-label" for="size-4">L</label>
												</div><!-- End .custom-checkbox -->
											</div><!-- End .filter-item -->

											<div class="filter-item">
												<div class="custom-control custom-checkbox">
													<input type="checkbox" class="custom-control-input" id="size-5">
													<label class="custom-control-label" for="size-5">XL</label>
												</div><!-- End .custom-checkbox -->
											</div><!-- End .filter-item -->

											<div class="filter-item">
												<div class="custom-control custom-checkbox">
													<input type="checkbox" class="custom-control-input" id="size-6">
													<label class="custom-control-label" for="size-6">XXL</label>
												</div><!-- End .custom-checkbox -->
											</div><!-- End .filter-item -->
										</div><!-- End .filter-items -->
									</div><!-- End .widget-body -->
								</div><!-- End .collapse -->
						</div><!-- End .widget -->

						%>
						<%# <div class="widget widget-collapsible">
							<h3 class="widget-title">
								<a data-toggle="collapse" href="#widget-4" role="button" aria-expanded="true"
									aria-controls="widget-4">
									Brand
								</a>
							</h3><!-- End .widget-title -->

							<div class="collapse show" id="widget-4">
								<div class="widget-body">
									<div class="filter-items">
										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-1">
												<label class="custom-control-label" for="brand-1">Next</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-2">
												<label class="custom-control-label" for="brand-2">River Island</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-3">
												<label class="custom-control-label" for="brand-3">Geox</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-4">
												<label class="custom-control-label" for="brand-4">New Balance</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-5">
												<label class="custom-control-label" for="brand-5">UGG</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-6">
												<label class="custom-control-label" for="brand-6">F&F</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

										<div class="filter-item">
											<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="brand-7">
												<label class="custom-control-label" for="brand-7">Nike</label>
											</div><!-- End .custom-checkbox -->
										</div><!-- End .filter-item -->

									</div><!-- End .filter-items -->
								</div><!-- End .widget-body -->
							</div><!-- End .collapse -->
			</div><!-- End .widget -->
			%>

		</div><!-- End .sidebar sidebar-shop -->

		<!-- <button id="clearButton">Clear</button> -->
		<button type="submit" id="submitButton">Submit</button>

		</form>
		</aside><!-- End .col-lg-3 -->


	</div><!-- End .row -->
	</div><!-- End .container -->
	</div><!-- End .page-content -->
</main><!-- End .main -->



<script>

	document.addEventListener('DOMContentLoaded', function () {
		var rangeSlider = document.getElementById('rangeSlider');
		var sliderValue1 = document.getElementById('sliderValue1');
		var sliderValue2 = document.getElementById('sliderValue2');

		var fromSpan = document.getElementById('from-span');
		var toSpan = document.getElementById('to-span');

		noUiSlider.create(rangeSlider, {
			start: [0, 20000], // Initial range values
			connect: true, // Enable the range between the handles
			range: {
				'min': 0,
				'max': 20000
			}
		});

		rangeSlider.noUiSlider.on('update', function (values) {
			sliderValue1.value = Math.floor(values[0]);
			sliderValue2.value = Math.floor(values[1]);
			fromSpan.innerHTML = Number(Math.floor(values[0])).toLocaleString('en-in', { style: 'currency', currency: 'INR', minimumFractionDigits: 0 })
			toSpan.innerHTML = Number(Math.floor(values[1])).toLocaleString('en-in', { style: 'currency', currency: 'INR', minimumFractionDigits: 0 })
		});
	});

</script>



<script>

	const checkboxes = document.querySelectorAll('.checkBox-input')
	console.log(checkboxes);



	const clearButton = document.getElementById('clearButton');

	const productsRow = document.getElementById('products-row')

	$('#filter-form').submit(function (e) {
		e.preventDefault()
		const min = document.getElementById('sliderValue1').value;
		const max = document.getElementById('sliderValue2').value;

		let selectedCategories = [];
		$('input:checked').each(function () {
			selectedCategories.push($(this).val())
		})
		console.log(selectedCategories, "selectedCategories");

		console.log(min);
		console.log(max);
		console.log(typeof selectedCategories, "selectedCategories");
		console.log(selectedCategories, "selectedCategories");

		filterData(selectedCategories, min, max);
	})

	function filterData(selectedCategories, min, max) {

		let data = {
			selectedCategories: selectedCategories,
			min: min,
			max: max
		}
		data = JSON.stringify(data)
		let html = ``;

		console.log(data, 'ddddddddaaaaaaaaaaaaaaa');

		$.ajax({
			url: '/productPage?filterData=' + data,
			type: 'get',

		})
			.done((res) => {
				console.log(res, "rreeeesssssssppppppprrrrrrrrooooooddddddddduuuuuucccccccct");
				let product = res.product;
				let loginStatus = res.loginStatus
				let cartCount = res.cartCount

				console.log(res, "resssssssssssssssssssssssssssssssssssssssssss");
				console.log(product, "res productttttttttttttttttttttttttttt");
				for (let i = 0; i < product.length; i++) {

					if (product[i].product_status) {
						html += `
						<div class="col-6 col-md-4 col-lg-4">
							<div class="product product-7 text-center">
										<figure class="product-media">
											<a href="/productDisplay/${product[i]._id}">
												<img src="/uploads/product-images/${product[i].image[0]}"
													alt="Product image" class="product-image" 	style="width: 30rem; height: 25rem;">
												
											</a>
											`

						if (!product[i].isInWishlist) {
							html += `
											<div class="product-action-vertical">
												<a href="#" data-value="${product[i]._id}"
												class="btn-product-icon btn-wishlist add-to-wishlist btn-expandable">
													<span>add to wishlist</span>
												</a>
											</div><!-- End .product-action-vertical -->
							`;
						} else {
							html += `
												<div class="product-action-vertical">
													<a href="/view-wishlist" class="btn-product-icon btn-wishlist btn-expandable bg-danger"  >
														<span style="background-color: red;">remove from wishlist</span>
													</a>
												</div><!-- End .product-action-vertical -->
							`;
						}


						if (!product[i].isInCart) {
							if (loginStatus) {
								html += `

														<div class="product-action">
															<a href="#" data-value="${product[i]._id}"
																class="add-product btn-product btn-cart"><span>add to
																	cart</span></a>

														</div><!-- End .product-action -->
									`;

							} else {
								html += `
															<div class="product-action">
																<a href="/login" class=" btn-product btn-cart"><span>add
																		to cart</span></a>
															</div><!-- End .product-action -->
									`;
							}
						} else {
							html += `
																	<div class="product-action">
																		<a href="/cart"
																			class="view-cart-products btn-product btn"><span>View
																				in cart</span></a>
																	</div><!-- End .product-action -->
									`;
						}

						html += `
										</figure><!-- End .product-media -->

										<div class="product-body">
											<div class="product-cat">
													<p>
														${product[i].product_description}
													</p>
												</div><!-- End .product-cat -->
											<h3 class="product-title">
												<a href="product.html">${product[i].product_name}</a>
											</h3><!-- End .product-title -->
											<div class="product-price">${product[i].product_price}</div><!-- End .product-price -->
										</div><!-- End .product-body -->
									</div><!-- End .product -->
								</div><!-- End .col-sm-6 col-lg-4 -->
							`;

					}

				}

				productsRow.innerHTML = html

				console.log("endddddddddddddd");

			})
			.fail((error) => {
				console.log(error);
			})
	}


	// Save checkbox states to localStorage
checkboxes.forEach(function (checkbox) {
    checkbox.addEventListener('change', function () {
        const checkboxStates = Array.from(checkboxes).map(function (cb) {
            return {
                id: cb.id,
                checked: cb.checked
            };
        });
        localStorage.setItem('checkboxStates', JSON.stringify(checkboxStates));
    });
});

// Clear button event listener
clearButton.addEventListener('click', function (e) {
    e.preventDefault();
    checkboxes.forEach(function (checkbox) {
        checkbox.checked = false;
    });

    // Reset range slider values
    rangeSlider.noUiSlider.reset();

    // Remove saved checkbox states from localStorage
    localStorage.removeItem('checkboxStates');
});

// Reset checkboxes and range slider on page load
window.addEventListener('load', function () {
    checkboxes.forEach(function (checkbox) {
        checkbox.checked = false;
    });

    // Reset range slider values
    rangeSlider.noUiSlider.reset();

    // Remove saved checkbox states from localStorage
    localStorage.removeItem('checkboxStates');
});

// Restore checkbox and range slider states from localStorage
window.addEventListener('DOMContentLoaded', function () {
    const savedStates = localStorage.getItem('checkboxStates');
    const checkboxStates = JSON.parse(savedStates);

    if (Array.isArray(checkboxStates)) {
        checkboxStates.forEach(function (state) {
            const checkbox = document.getElementById(state.id);
            if (checkbox) {
                checkbox.checked = state.checked;
            }
        });
    }
});


</script>



<script>

	$(document).ready(function () {
		$('#products-row').on('click', '.add-product', function (e) {
			e.preventDefault();

			const prodId = $(this).data('value');
			console.log('clicked', prodId);

			$.ajax({
				url: '/add-to-cart/' + prodId,
				type: 'get'
			})
				.done((res) => {
					console.log(res, '???????????????????????????????????????????');
					swal("successfull", `${res.message}`, "success")
						.then(() => {
							location.reload();
						});
				})
				.fail((err) => {
					console.log(err);
				});
		});
	});

</script>

<script>
	$(document).ready(function () {
		$(document).on('click', '.add-to-wishlist', function (e) {
			e.preventDefault();

			var productId = $(this).data('value');
			console.log(productId, 'pppprrrrrrrrrrrrrrrroooooooooooo');

			Swal.fire({
				title: 'Add to Wishlist',
				text: 'Are you sure you want to add this item to your wishlist?',
				icon: 'question',
				showCancelButton: true,
				confirmButtonText: 'Yes',
				cancelButtonText: 'No'
			}).then((result) => {
				if (result.isConfirmed) {
					$.ajax({
						url: '/wishlist',
						type: 'POST',
						data: { productId: productId },
						success: function (response) {
							console.log(response);
							Swal.fire({
								title: 'Success',
								text: 'Item added to wishlist',
								icon: 'success'
							}).then(() => {
								location.reload(); // Reload the page
							});
						},
						error: function (error) {
							console.log(error);
							Swal.fire({
								title: 'Error',
								text: 'Failed to add item to wishlist',
								icon: 'error'
							});
						}
					});
				}
			});
		});
	});


</script>